<ui:composition template="/layouts/layoutInterior.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="content">
		<div class="content_newForm">
				<div class="titluFormular">
					<h3 style="margin-top: 0">Modificați membru</h3>
				</div>

		<div class="container-fluid">
			<h:form id="formModific" class="tabsInvert">
				<p:growl id="msgs" showDetail="true" />
				<p:accordionPanel multiple="true" activeIndex="0,1,2,3">
					<p:tab title="Informații personale / comunicare  membru: #{userBean.utilizator.numeComplet}">
						<div class="tabAcordeon">
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="nombre" value="Nume:" /></b>
									<p:inputText id="nombre"
										value="#{userBean.utilizator.nume}" required="true"
										requiredMessage="Introduce numele" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="prenume" value="Prenume:" /></b>
									<p:inputText id="prenume" required="true"
										value="#{userBean.utilizator.prenume}"
										requiredMessage="Introduce numele de familie" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="nif" value="CNP:" /></b>
									<p:inputText id="nif" value="#{userBean.utilizator.idCard}" />
								</div>	
							</div>
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="teamSelect" value="Funcție:" /></b>
									<p:selectOneMenu value="#{userBean.utilizator.team.id}" 
										id="teamSelect" class="selectFiltru" style="min-width:initial;" >
										<f:selectItem itemLabel="Alege una..." itemValue="" />
										<f:selectItems value="#{userBean.listaFunctii}"
											var="team"
											itemLabel="#{team.nume}"
											itemValue="#{team.id}" />
									</p:selectOneMenu>								
								</div>
								
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="username" value="Utilizator:" /></b>
									<p:inputText id="username"
										value="#{userBean.utilizator.username}" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="rolSelect" value="Rol:" /></b>
									<p:importEnum
										type="ro.stad.online.gesint.persistence.entities.enums.RolEnum"
										var="rol" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.utilizator.role}"
										id="rolSelect"
										required="true" requiredMessage="Selectați un rol" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alege un rol" itemValue="" />
										<f:selectItems value="#{rol.ALL_ENUM_VALUES}" var="rol"
											itemLabel="#{rol.description}" itemValue="#{rol}" />
									</p:selectOneMenu>							
								</div>
							</div>
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="mobilePhone" value="Telefon :" /></b>
									<p:inputText id="mobilePhone"
										value="#{userBean.utilizator.phone}" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="email" value="Email:" /></b>
									<p:inputText id="email" value="#{userBean.utilizator.email}" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="address" value="Adresa:" /></b>
									<p:inputText id="address" value="#{userBean.utilizator.adresa}" />
								</div>
							</div>
							<div class="ui-g">												
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="numberCard" value="Numărul documentului de identitate:" /></b>
									<p:inputText id="numberCard" value="#{userBean.utilizator.numarCard}" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="birthDate" value="Data nașterii:" /></b>
									<p:calendar id="birthDate" pattern="dd/MM/yyyy" locale="ro" navigator="true" 
									maxdate="#{currentDate}" value="#{userBean.utilizator.dataNasterii}" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="educatieSelect" value="Nivel de educație:" /></b>
									<p:importEnum
										type="ro.stad.online.gesint.persistence.entities.enums.EducatieEnum"
										var="educatie" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.utilizator.educatie}"
										id="educatieSelect"
										required="true" requiredMessage="Selectați un nivel de educație" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alege un nivel de educație" itemValue="" />
										<f:selectItems value="#{educatie.ALL_ENUM_VALUES}" var="educatie"
											itemLabel="#{educatie.description}" itemValue="#{educatie}" />
									</p:selectOneMenu>									
								</div>
							</div>
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="workplace" value="Locul de muncă:" /></b>
									<p:inputText id="workplace" value="#{userBean.utilizator.locMunca}" />
								</div>	
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="sexSelect" value="Sexul:" /></b>
									<p:importEnum
										type="ro.stad.online.gesint.persistence.entities.enums.SexEnum"
										var="sex" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.utilizator.sex}"
										id="sexSelect"
										required="true" requiredMessage="Selectați tipul sexului" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alegeți tipul sexului" itemValue="" />
										<f:selectItems value="#{sex.ALL_ENUM_VALUES}" var="sex"
											itemLabel="#{sex.description}" itemValue="#{sex}" />
									</p:selectOneMenu>								
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="civilStatusSelect" value="Starea civilă:" /></b>
									<p:importEnum
										type="ro.stad.online.gesint.persistence.entities.enums.StatutCivilEnum"
										var="civilStatus" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.utilizator.statutCivil}"
										id="civilStatusSelect"
										required="true" requiredMessage="Selectați starea civilă" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alegeți starea civila" itemValue="" />
										<f:selectItems value="#{civilStatus.ALL_ENUM_VALUES}" var="civilStatus"
											itemLabel="#{civilStatus.description}" itemValue="#{civilStatus}" />
									</p:selectOneMenu>							
								</div>							
							</div>						
							
							<div class="ui-g">							
								<div class="ui-g-12 ui-md-6 ui-lg-4">
								<b><h:outputLabel for="validat" value="Activ/ Blocat:" /></b>
								<p:selectOneMenu styleClass="form-control form-select" id="validat"
									value="#{userBean.utilizator.validat}">
									<f:selectItem itemLabel="ACTIV" itemValue="true" />
									<f:selectItem itemLabel="BLOCAT" itemValue="false" />
								</p:selectOneMenu>
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
								
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
								<b><h:outputLabel for="judeteSelectate" value="Județul/Organizația (*):" /></b>
									<p:selectOneMenu value="#{userBean.judetSelect.nume}"  id="judeteSelectate" styleClass="form-control form-select" filter="true" filterMatchMode="startsWith" >
										<f:selectItem itemLabel="Toate" itemValue="" />
										<f:selectItems value="#{userBean.judete}" var="judet" itemLabel="#{judet.nume}" itemValue="#{judet.nume}" />
										 <p:ajax event="change" update="municipiuSelectat"
											listener="#{userBean.actualizareLocalitati(userBean.judetSelect.nume)}" />   
									</p:selectOneMenu> 								
								</div>
							</div>
							<p:separator />
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">								
								<b><h:outputLabel for="municipiuSelectat" value="Localitatea/Sector (*):" /></b>
								<p:selectOneMenu value="#{userBean.utilizator.localitate.nume}" id="municipiuSelectat" filter="true" 
									filterMatchMode="startsWith" styleClass="form-control form-select" >															
									<f:selectItems value="#{userBean.localitati}" var="municipio" itemLabel="#{municipio.nume}" itemValue="#{municipio.nume}" />
								</p:selectOneMenu>
								<p:messages for="municipiuSelectat" autoUpdate="true"  closable="true"/>
							</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="municipiuSelectat"  value="Înregistrați o nouă localitate (*):" /></b>
									<p:separator />
									<p:commandButton id="buttMunicipio" title="Adăugați o nouă localitate (trebuie să selectați anterior un județ)" 
										type="button" onclick="PF('dialogLocalitate').show()" icon="fa fa-fw fa fa-plus" update="creazaMunicipiu" 
										disabled="#{userBean.localitati == null}"/>									
								</div>													
							</div>					
							<p:separator />
							<div class="ui-g">									
								<div class="ui-g-12 ui-md-6 ui-lg-4">								
									<b><h:outputLabel for="imagenG" value="Fotografia :" /></b>
									<p:separator />
									<p:graphicImage rendered="#{not empty userBean.utilizator.photo}" id="imagenG" value="#{userBean.utilizator.imageUser}" cache="false" stream="false">
									<f:param name="id" value="#{userBean.utilizator.id}" />
									 </p:graphicImage>
									</div>	
									<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="imagineNoua" value="Încarcă noua fotografie:" /></b>
									<p:separator />
									<p:fileUpload fileUploadListener="#{userBean.incarcareImagine}" mode="advanced" dragDropSupport="false" id="imagineNoua"
									   sizeLimit="204800" invalidSizeMessage=" Dimensiunea maximă permisă este de 20MB" required="true" 
									   fileLimit="1" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" 
									   uploadLabel="Salvează noua fotografie" cancelLabel="Renunțare" label="Încarcă/Caută fotografia" update="imagenG" /> 
								</div>									
							</div>
							<div class="butoaneFormular">
								<p:commandButton actionListener="#{userBean.restabilireParola}"
									value="Resetați parola" />
								<p:commandButton
									actionListener="#{userBean.modificareUtilizator(userBean.utilizator,userBean.judetSelect.nume,userBean.utilizator.localitate.nume)}"
									value="Salvare" update ="@form"/>
							</div>
						</div>
					</p:tab>
					</p:accordionPanel>
				<p:dialog id="dialog" widgetVar="dialogMessage" header="INFO"
					closable="true">
					<p:messages for="dialogMessage" autoUpdate="true" showDetail="true"
						showSummary="true" />
						 <div class="centrareButoaneDialog">
                   <p:button value="Închideţi" outcome="/users/users" />
               </div>
				</p:dialog>
			
		<p:dialog id="creazaMunicipiu" widgetVar="dialogLocalitate" header="Înregistrare oraș/localitate nouă" position="center" resizable="false" onShow="$('[id*=inputNume]').val('');" modal="true" width="40%" >
			<h:outputLabel for="inputNume" value=" Numele noii localități (*):" />
			<p:inputText id="inputNume" binding="#{numeLocalitate}"
				required="#{param['form:guardar']!=null}" requiredMessage="Numele orașului nu poate fi gol" converter="#{trimConverter}" />
			
			<h:outputLabel for="typeLocality" value="Alegeți tipul localității (*):" />
			<p:importEnum type="ro.stad.online.gesint.persistence.entities.enums.TipLocalitateEnum"
				var="typeLocalitys" allSuffix="ALL_ENUM_VALUES" />
				<p:selectOneMenu value="#{userBean.tipLocalitateSelectat}" id="typeLocality" class="selectFiltru" style="min-width:initial;" 
				effect="fold" required="#{param['form:guardar']!=null}"  requiredMessage="Este obligatoriu să alegeți un tip de localitate">
					<f:selectItem itemLabel="Alege unul..." itemValue="" />
					<f:selectItems value="#{typeLocalitys.ALL_ENUM_VALUES}" var="tipLocalitateSelectat" itemLabel="#{tipLocalitateSelectat.description}"
				itemValue="#{tipLocalitateSelectat}" />
				</p:selectOneMenu>
			<b><h:outputLabel for="judetSelectat" value="Județul/Organizația:" /></b>
									<p:selectOneMenu value="#{userBean.judetSelect.nume}" 
										id="judetSelectat" filter="true" filterMatchMode="startsWith"
										 styleClass="form-control form-select" >
										<f:selectItem itemLabel="#{userBean.judetSelect.nume}" />
										<f:selectItems value="#{userBean.judete}"  var="provincia"
											itemLabel="#{provincia.nume}" itemValue="#{provincia.nume}" />
									</p:selectOneMenu>		
			
			<div class="centrareButoaneDialog">
				<p:commandButton id="guardar" value="Înregistrează" actionListener="#{userBean.nouaLocalitate(numeLocalitate.value, userBean.judetSelect.nume,userBean.tipLocalitateSelectat, userBean.utilizator)}" 
				update ="@form"  oncomplete="PF('dialogLocalitate').hide()"/>
				<p:commandButton value="Închidere" onclick="PF('dialogLocalitate').hide()"/>
			</div>
		</p:dialog>	
				<div class="butoaneFormular">
			<p:button outcome="/users/users" value="Renunţare" icon="fa fa-fw fa-undo" />
		</div>			
		</h:form>

		</div>

		</div>

	</ui:define>
</ui:composition>

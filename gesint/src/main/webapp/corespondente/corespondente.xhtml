<ui:composition template="../layouts/layoutInterior2.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<ui:define name="content">
 
		<h:form id="cautareListaCorespondenta">
			<div class="filtru">
				<div class="blocFormular">
					<div class="titluFormular">Căutare corespondențe</div>					
					<div class="ui-g coloanaCautare">
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<h:outputLabel for="titlu" styleClass="cautator"
								value="Titlu:" />
						</div>
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<p:inputText id="titlu"
								value="#{corespondentaBean.filtruCorespondenta.titlu}" />
						</div>
					</div>
					<div class="ui-g coloanaCautare">
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<h:outputLabel for="tipCorespondenta" styleClass="cautator"
								value="Tipul corespondenței" />
						</div>
						<div class="ui-g-12 ui-md-6 ui-lg-6">
					            <p:importEnum type="ro.stad.online.gesint.persistence.entities.enums.CategorieEnum" var="tipos" allSuffix="ALL_ENUM_VALUES" />
				                    <p:selectOneMenu value="#{corespondentaBean.filtruCorespondenta.tipCorespondenta}" id="tipCorespondenta" class="selectFiltru">
				                        <f:selectItem itemLabel="Alege unul..." itemValue="" />
				                        <f:selectItems value="#{tipos.ALL_ENUM_VALUES}" var="tip" itemLabel="#{tip.description}" itemValue="#{tip}" />
				                    </p:selectOneMenu>
						</div>
					</div>
					<div class="ui-g coloanaCautare">
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<h:outputLabel for="username" styleClass="cautator"
								value="Destinatar:" />
						</div>
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<p:inputText id="username"
								value="#{corespondentaBean.filtruCorespondenta.destinatar}" />
						</div>
					</div>
					<div class="ui-g coloanaCautare">
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<h:outputLabel for="fechaDesde" value="Data trimisă de la:" />
						</div>
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<p:calendar id="fechaDesde" pattern="dd/MM/yyyy" locale="es"
								navigator="true" maxdate="#{currentDate}"
								value="#{corespondentaBean.filtruCorespondenta.dateFromSend}" />
						</div>
					</div>
					<div class="ui-g coloanaCautare">
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<h:outputLabel for="fechaHasta" value="Data trimisă până la:" />
						</div>
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<p:calendar id="fechaHasta" pattern="dd/MM/yyyy" locale="es"
								navigator="true" maxdate="#{currentDate}"
								value="#{corespondentaBean.filtruCorespondenta.dateUntilSend}" />
						</div>
					</div>
					<div class="ui-g coloanaCautare">
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<h:outputLabel for="dateFromCreated" value="Data creării de la:" />
						</div>
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<p:calendar id="dateFromCreated" pattern="dd/MM/yyyy" locale="es"
								navigator="true" maxdate="#{currentDate}"
								value="#{corespondentaBean.filtruCorespondenta.dateFromCreated}" />
						</div>
					</div>
					<div class="ui-g coloanaCautare">
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<h:outputLabel for="dateUntilCreated" value="Data creării până la:" />
						</div>
						<div class="ui-g-12 ui-md-6 ui-lg-6">
							<p:calendar id="dateUntilCreated" pattern="dd/MM/yyyy" locale="es"
								navigator="true" maxdate="#{currentDate}"
								value="#{corespondentaBean.filtruCorespondenta.dateUntilCreated}" />
						</div>
					</div>
				</div>
				<div class="butoaneFormular">
					<p:commandButton actionListener="#{corespondentaBean.cautareCorespondente}"
						value="Căutare" update="panouCorespondente" icon="fa fa-search"
						oncomplete="$('.mesajeFaraRezultate').css('opacity', 1)"
						onstart="PF('statusDialog').show()" class="right"
						onsuccess="PF('statusDialog').hide()" />
					<p:commandButton action="#{corespondentaBean.getFormNouaCorespondenta()}" icon="fa fa-plus" class="left"
						value="Corespondența nouă" />
				</div>
				<p:separator />	
				<div class="butoaneFormular">
					<p:commandButton actionListener="#{corespondentaBean.curatareFiltru}" class="left"
						value="Curățați filtrele" update="cautareListaCorespondenta" icon="fa fa-eraser" />
				</div>
			</div>
			<div class="rezultateFiltru">
				<p:outputPanel layout="block" id="panouCorespondente">
					<p:dataTable id="tablaCorespondente" var="alerta" rowIndexVar="rowIndex"
						value="#{corespondentaBean.model}" rows="20" sortOrder="descending"
						draggableColumns="true" lazy="true"
		                paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
		                resizableColumns="true" paginator="true"
						rowKey="#{alerta.id}"
						pageLinks="4" paginatorPosition="bottom"
						onkeypress="if (event.keyCode == 13) {return false; }" styleClass="modHeaderTable"
						emptyMessage="Nu există niciun rezultat care să corespundă parametrilor căutării dvs." paginatorAlwaysVisible="false">
						<f:facet name="header">
							<p:outputPanel >
								<div class="left">
									<h:commandLink
										rendered="#{corespondentaBean.model.rowCount ne 0}">
										<p:graphicImage value="/images/xls.png" />
										<p:dataExporter type="xls" target="tablaCorespondente"
											fileName="listaAlertas" />
									</h:commandLink>
									<h:commandLink
										rendered="#{corespondentaBean.model.rowCount ne 0}">
										<p:graphicImage value="/images/pdf.png" />
										<p:dataExporter type="pdf" target="tablaCorespondente"
											fileName="listaAlertas" />
									</h:commandLink>
									<h:commandLink
										rendered="#{corespondentaBean.model.rowCount ne 0}">
										<p:graphicImage value="/images/csv.png" />
										<p:dataExporter type="csv" target="tablaCorespondente"
											fileName="listaAlertas" />
									</h:commandLink>
								</div>
								<span class="titlu">CORESPONDENȚE ELECTRONICE (EMAIL)</span>
								 <div class="right">
								 <p:commandButton id="toggler" type="button" value="Coloane" styleClass="botonToggler" icon="fa fa-th" />
			                        <p:columnToggler datasource="tablaCorespondente" trigger="toggler">
			                            <p:ajax event="toggle" listener="#{corespondentaBean.onToggle}" />
			                        </p:columnToggler>
                        </div>
							</p:outputPanel>
							
						</f:facet>                    	
						<p:column headerText="Data creării"
							sortBy="#{alerta.dateCreate}" style="width:10%;"
							visible="#{corespondentaBean.list[0]}"
							exportable="#{corespondentaBean.list[0]}">
							<h:outputText value="#{alerta.dateCreate}">
								<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Madrid" />
							</h:outputText>
						</p:column>
						<p:column headerText="Data trimiterii"
							sortBy="#{alerta.dateCreate}" style="width:11%;"
							visible="#{corespondentaBean.list[1]}"
							exportable="#{corespondentaBean.list[1]}">						
							<p:outputPanel rendered="#{!empty alerta.dataTrimiteri}">
								<h:outputLabel styleClass="fa fa-check-circle"/>
								<h:outputText  value="#{alerta.dataTrimiteri}" >
							<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Madrid" /></h:outputText>
							</p:outputPanel>
							<p:outputPanel rendered="#{empty alerta.dataTrimiteri}">
								<h:outputLabel styleClass="fa fa-warning modColor"/>
								<span>Netrimis</span>
							</p:outputPanel>
						</p:column>
						<p:column headerText="Destinatar" sortBy="#{alerta.destinatari}" style="width:25%;"
							visible="#{corespondentaBean.list[2]}"
							exportable="#{corespondentaBean.list[2]}">
							<h:outputText value="#{alerta.destinatari}"/>
						</p:column>

						<p:column headerText="Tip de corespondență" sortBy="#{alerta.tipCorespondenta.description}"
							style="width:17%;" visible="#{corespondentaBean.list[3]}"
							exportable="#{corespondentaBean.list[3]}">
							<h:outputText value="#{alerta.tipCorespondenta.description}" />
						</p:column>
						
						<p:column headerText="Titlu" sortBy="#{alerta.titlu}" style="width:25%;"
							visible="#{corespondentaBean.list[4]}"
							exportable="#{corespondentaBean.list[4]}">
							<h:outputText value="#{alerta.titlu}" />
						</p:column>
						<p:column  styleClass="butonTabla"
							exportable="false" style="width:14%;" toggleable="false">
							<p:commandButton title="Modificați corespondența" icon="fa fa-fw fa-eye"
								styleClass="modBtn"
								action="#{corespondentaBean.deschidereDialogCorespondentaCuDate(alerta)}" 
								onstart="PF('statusDialog').show()" 
								onsuccess="PF('statusDialog').hide()"
								immediate="true"
								update="cautareListaCorespondenta"/>
                        <p:commandButton title="Eliminare corespondența" icon="fa fa-trash" actionListener="#{corespondentaBean.eliminareCorespondenta(alerta)}" update=":cautareListaCorespondenta:panouCorespondente tablaCorespondente">
                            <p:confirm header="Eliminare corespondența" message="Sunteți sigur că doriți să eliminați DEFINITIV acestă corespondența?" icon="fa fa-warning-sign" />
                        </p:commandButton>

							<h:commandLink title="Modificare corespondența"  styleClass="fa fa-fw fa-pencil ui-button ui-state-default ui-CommandLink modBtn ui-CommandLink-icono"
								action="#{corespondentaBean.getFormModificareCorespondenta(alerta)}" update=":cautareListaCorespondenta:panouCorespondente tablaCorespondente" />
						</p:column>
						<f:facet name="footer" >
       				 		Total:
							<h:outputText value="#{corespondentaBean.model.rowCount}">
	    						<f:convertNumber type="number"
                                 maxIntegerDigits="5"
                                 maxFractionDigits="0"/>
							</h:outputText>
							registre
    					</f:facet>
					</p:dataTable>
				</p:outputPanel>
				<p:confirmDialog global="true">
					<div class="centrareButoaneDialog">
						<p:commandButton value="Acceptați" type="button"
							styleClass="ui-confirmdialog-yes" icon="fa fa-check" />
						<p:commandButton value="Anulați" type="button"
							styleClass="ui-confirmdialog-no" icon="fa fa-remove" />
					</div>
				</p:confirmDialog>
			</div>
			<p:dialog widgetVar="statusDialog" modal="true" draggable="false"
				closable="false" resizable="false" showHeader="false">
				<p:graphicImage value="/images/loading.gif" />
			</p:dialog>
			
			
			<p:dialog header="Date corespondență" widgetVar="dialogCorespondenta" modal="true" resizable="false" showEffect="fade" hideEffect="fade" >
				<h:form id="formularDetaliuCorespondenta">
				    <h:panelGrid columns="2" columnClasses="text-blod, label" >															
						<h:outputLabel value="Subiect:" />
						<h:outputLabel escape="false" value="#{corespondentaBean.corespondentaActuala.titlu}" />
						<h:outputLabel value="Descriere:" />
						<h:outputLabel escape="false" value="#{corespondentaBean.corespondentaActuala.descriere}" style="max-height:200px;overflow-y:auto;display:block;" />
					</h:panelGrid>
				</h:form>
			</p:dialog>
		</h:form>
		<h:form id="formIncarcareDocumente">
			<p:dialog header="Atașați documente corespondenței electronice" widgetVar="dlgIncarcareDocument" dynamic="true" width="800" height="800">
				<div class="aclaratii">Se acceptă documentele care coincid ca nume și extensie cu documentele încărcate.</div>
				<div class="blocView">
		            <p:dataTable var="document" value="#{corespondentaBean.listaDocumente}">
		                <p:column headerText="DOCUMENT" width="50%">
		                    <h:outputText value="#{document.descriere}" />
		                </p:column>
		                <p:column headerText="NUME" width="50%">
		                    <h:outputText value="#{document.nume}" />
		                </p:column>
		            </p:dataTable>
		        </div>
		       <p:separator />
		        <div class="aclaratii">
		            (1).- Pentru fiecare tip de document, unul sau mai multe documente pot fi încărcate simultan. 
		            <strong>Dacă oricare dintre ele este alcătuită din două sau mai multe părți, numele lor trebuie să înceapă cu numele necesar pentru documentul respectiv și un număr secvențial 
		            </strong> (ex: organigrama_1.doc, organigramaParte2.ppt). Dimensiunea maximă per fișier încărcat este de 20 MB.
		        </div>
		                <div class="blocView">
            <h:form id="formInregistrare">

                <p:fileUpload width="50%" cancelLabel="ANULARE" label="SELECTAREA DOCUMENTULUI" uploadLabel="ÎNCĂRCARE DOCUMENTE" 
                fileUploadListener="#{corespondentaBean.gestioneazaIncarcareDocument}" mode="advanced" dragDropSupport="false" 
                sizelimit="20971520" multiple="true" update="tablaDocumente" autofileLimit="30" 
                allowTypes="/(\.|\/)(jpe?g|png|bmp|doc|docx|pptx|ppt|pub|xls|xlsx|pdf)$/i" sequential="true" />


                <p:outputPanel id="panouAtasament">
                    <p:dataTable id="tablaDocumente" var="document" value="#{corespondentaBean.documenteIncarcate}" editable="true" onkeypress="if (event.keyCode == 13) {return false; }" emptyMessage="Nu sunt încărcate documente.">
                        <p:ajax event="rowEdit" listener="#{corespondentaBean.onRowEdit}" update=":formIncarcareDocumente:formInregistrare:msgs" />

                        <p:column headerText="Documentele încărcate">
                            <h:outputText value="#{document.nume}" />
                        </p:column>
                        <p:column styleClass="butonTabla">
                            <p:commandButton icon="fa fa-fw fa-download" ajax="false" actionListener="#{corespondentaBean.descarcareFisier(document.id)}" title="Descărcați documentul">
                                <p:fileDownload value="#{corespondentaBean.file}" />
                            </p:commandButton>
                        </p:column>
                        <p:column styleClass="butonTabla" >
                            <p:commandButton title="Elimină" icon="fa fa-trash" actionListener="#{corespondentaBean.eliminareDocument(document)}" update=":formInregistrare:panouAtasament tablaDocumente">
                                <p:confirm header="Ștergeți documentul" message="Sigur doriți să ștergeți acest document?" icon="fa fa-warning-sign" />
                            </p:commandButton>
                        </p:column>

                    </p:dataTable>
                </p:outputPanel>
                <p:confirmDialog global="true">
                    <div class="centrareButoaneDialog">
                        <p:commandButton value="Acceptați" type="button" styleClass="ui-confirmdialog-yes" icon="fa fa-check" />
                        <p:commandButton value="Anulați" type="button" styleClass="ui-confirmdialog-no" icon="fa fa-remove" />
                    </div>
                </p:confirmDialog>
                <div class="butoaneFormular">
                    <p:button outcome="/corespondente/corespondente" value="Înapoi" icon="fa fa-fw fa-undo" />
                </div>
                <p:messages id="msgs" autoUpdate="true" closable="true" showDetail="true" />
            </h:form>
        </div>
				
			</p:dialog>
		</h:form>
	</ui:define>

</ui:composition>
